{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Accessing GaiaArchive with TAP+"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "In this tutorial, we go through how to access, examine and use Gaia TAP+ service using **gapipes**.\n",
    "For databases as large as Gaia (and many other large astronomical surveys for that matter),\n",
    "downloading everything as a set of files is no longer practical.\n",
    "The Table Access Protocol (TAP) was designed for the purpse of communicating general tabular data by the [IVOA](http://www.ivoa.net/).\n",
    "For [Gaia](http://gea.esac.esa.int/archive/) and other ESA Services, the ESDC extended this protocol, called TAP+.\n",
    "The extension includes user table space, sharing tables among groups, and listing jobs.\n",
    "\n",
    "\n",
    "## Why another Gaia TAP client?\n",
    "\n",
    "There is already a TAP python client in the popular [astroquery](https://astroquery.readthedocs.io/en/latest/). So why another one?\n",
    "\n",
    "The current implementation in astroquery is excessively verbose, has clunky api design, does not report an informative error message and does not nicely cover all the 'quarks' of GaiaArchive. This module is written more or less out of frustration.\n",
    "If astroquery eventually change to implementation that uses [pyvo](http://pyvo.readthedocs.io), which has a much well-defined code structure and cleaner interface, this module can retire."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Getting started\n",
    "\n",
    "In **gapipes**, there are two core classes that interfaces these services:\n",
    "one for plain TAP (`gapipes.TAP`) and one for GaiaTAP+ (`gapipes.GaiaTapPlus`).\n",
    "While they are written so that you can point at any available service,\n",
    "a default instance `gapipes.gaia` is already defined pointing at [the official Gaia Archive](http://gea.esac.esa.int/archive/).\n",
    "\n",
    "**NOTE** Following [Yagni](https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it) principle, **gapipes** does not implement _all_ [capabilities of Gaia TAP+](http://gea.esac.esa.int/archive-help/index.html) such as sharing tables with other users. If you need any missing feature of Gaia TAP+ in **gapipes**, feel free to open [an issue or a pull request](https://github.com/smoh/gapipes)."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "GaiaTapPlus(\"gea.esac.esa.int\", \"/tap-server/tap\", \"https\", 443)"
      ]
     },
     "execution_count": 1,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import gapipes as gp\n",
    "\n",
    "gp.gaia"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Inspecting table meta data\n",
    "\n",
    "The list of tables and columns available can be inspected using `tables` and `columns` attribute, which are pandas DataFrames."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "total number of tables: 80\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>schema</th>\n",
       "      <th>table_name</th>\n",
       "      <th>description</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>public</td>\n",
       "      <td>hipparcos</td>\n",
       "      <td>hipparcos original catalogue (J1991.25)</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>public</td>\n",
       "      <td>hipparcos_newreduction</td>\n",
       "      <td>Hipparcos New Reduction: The Astrometric Catal...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>public</td>\n",
       "      <td>hubble_sc</td>\n",
       "      <td>Hubble Source Catalogue</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>public</td>\n",
       "      <td>igsl_source</td>\n",
       "      <td>null</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>public</td>\n",
       "      <td>igsl_source_catalog_ids</td>\n",
       "      <td>SourceId in original  catalogues</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   schema               table_name  \\\n",
       "0  public                hipparcos   \n",
       "1  public   hipparcos_newreduction   \n",
       "2  public                hubble_sc   \n",
       "3  public              igsl_source   \n",
       "4  public  igsl_source_catalog_ids   \n",
       "\n",
       "                                         description  \n",
       "0            hipparcos original catalogue (J1991.25)  \n",
       "1  Hipparcos New Reduction: The Astrometric Catal...  \n",
       "2                            Hubble Source Catalogue  \n",
       "3                                               null  \n",
       "4                   SourceId in original  catalogues  "
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "print('total number of tables:', len(gp.gaia.tables))\n",
    "gp.gaia.tables.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>schema</th>\n",
       "      <th>table_name</th>\n",
       "      <th>column_name</th>\n",
       "      <th>unit</th>\n",
       "      <th>dtype</th>\n",
       "      <th>description</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>public</td>\n",
       "      <td>hipparcos</td>\n",
       "      <td>astroref</td>\n",
       "      <td></td>\n",
       "      <td>VARCHAR</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>public</td>\n",
       "      <td>hipparcos</td>\n",
       "      <td>bd</td>\n",
       "      <td></td>\n",
       "      <td>VARCHAR</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>public</td>\n",
       "      <td>hipparcos</td>\n",
       "      <td>btmag</td>\n",
       "      <td></td>\n",
       "      <td>REAL</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>public</td>\n",
       "      <td>hipparcos</td>\n",
       "      <td>b_v</td>\n",
       "      <td></td>\n",
       "      <td>REAL</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>public</td>\n",
       "      <td>hipparcos</td>\n",
       "      <td>ccdm</td>\n",
       "      <td></td>\n",
       "      <td>VARCHAR</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   schema table_name column_name unit    dtype description\n",
       "0  public  hipparcos    astroref       VARCHAR            \n",
       "1  public  hipparcos          bd       VARCHAR            \n",
       "2  public  hipparcos       btmag          REAL            \n",
       "3  public  hipparcos         b_v          REAL            \n",
       "4  public  hipparcos        ccdm       VARCHAR            "
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gp.gaia.columns.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "So you can easily filter these tables using pandas methods."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>schema</th>\n",
       "      <th>table_name</th>\n",
       "      <th>description</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>public</td>\n",
       "      <td>hipparcos</td>\n",
       "      <td>hipparcos original catalogue (J1991.25)</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>public</td>\n",
       "      <td>hipparcos_newreduction</td>\n",
       "      <td>Hipparcos New Reduction: The Astrometric Catal...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>public</td>\n",
       "      <td>hubble_sc</td>\n",
       "      <td>Hubble Source Catalogue</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>public</td>\n",
       "      <td>igsl_source</td>\n",
       "      <td>null</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>public</td>\n",
       "      <td>igsl_source_catalog_ids</td>\n",
       "      <td>SourceId in original  catalogues</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>public</td>\n",
       "      <td>tycho2</td>\n",
       "      <td>The Tycho-2 Catalogue is an astrometric refere...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>public</td>\n",
       "      <td>dual</td>\n",
       "      <td>auxiliary table to be used as dummy from</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   schema               table_name  \\\n",
       "0  public                hipparcos   \n",
       "1  public   hipparcos_newreduction   \n",
       "2  public                hubble_sc   \n",
       "3  public              igsl_source   \n",
       "4  public  igsl_source_catalog_ids   \n",
       "5  public                   tycho2   \n",
       "6  public                     dual   \n",
       "\n",
       "                                         description  \n",
       "0            hipparcos original catalogue (J1991.25)  \n",
       "1  Hipparcos New Reduction: The Astrometric Catal...  \n",
       "2                            Hubble Source Catalogue  \n",
       "3                                               null  \n",
       "4                   SourceId in original  catalogues  \n",
       "5  The Tycho-2 Catalogue is an astrometric refere...  \n",
       "6           auxiliary table to be used as dummy from  "
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gp.gaia.tables.query('schema == \"public\"')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>schema</th>\n",
       "      <th>table_name</th>\n",
       "      <th>description</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>37</th>\n",
       "      <td>gaiadr1</td>\n",
       "      <td>gaia_source</td>\n",
       "      <td>This table has an entry for every Gaia observe...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>78</th>\n",
       "      <td>gaiadr2</td>\n",
       "      <td>gaia_source</td>\n",
       "      <td>This table has an entry for every Gaia observe...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "     schema   table_name                                        description\n",
       "37  gaiadr1  gaia_source  This table has an entry for every Gaia observe...\n",
       "78  gaiadr2  gaia_source  This table has an entry for every Gaia observe..."
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gp.gaia.tables.query('table_name == \"gaia_source\"')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Have a look at one particular table in detail."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>schema</th>\n",
       "      <th>table_name</th>\n",
       "      <th>column_name</th>\n",
       "      <th>unit</th>\n",
       "      <th>dtype</th>\n",
       "      <th>description</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1531</th>\n",
       "      <td>gaiadr2</td>\n",
       "      <td>gaia_source</td>\n",
       "      <td>solution_id</td>\n",
       "      <td></td>\n",
       "      <td>BIGINT</td>\n",
       "      <td>Solution Identifier</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1532</th>\n",
       "      <td>gaiadr2</td>\n",
       "      <td>gaia_source</td>\n",
       "      <td>designation</td>\n",
       "      <td></td>\n",
       "      <td>VARCHAR</td>\n",
       "      <td>Unique source designation (unique across all D...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1533</th>\n",
       "      <td>gaiadr2</td>\n",
       "      <td>gaia_source</td>\n",
       "      <td>source_id</td>\n",
       "      <td></td>\n",
       "      <td>BIGINT</td>\n",
       "      <td>Unique source identifier (unique within a part...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1534</th>\n",
       "      <td>gaiadr2</td>\n",
       "      <td>gaia_source</td>\n",
       "      <td>random_index</td>\n",
       "      <td></td>\n",
       "      <td>BIGINT</td>\n",
       "      <td>Random index used to select subsets</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1535</th>\n",
       "      <td>gaiadr2</td>\n",
       "      <td>gaia_source</td>\n",
       "      <td>ref_epoch</td>\n",
       "      <td>yr</td>\n",
       "      <td>DOUBLE</td>\n",
       "      <td>Reference epoch</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "       schema   table_name   column_name unit    dtype  \\\n",
       "1531  gaiadr2  gaia_source   solution_id        BIGINT   \n",
       "1532  gaiadr2  gaia_source   designation       VARCHAR   \n",
       "1533  gaiadr2  gaia_source     source_id        BIGINT   \n",
       "1534  gaiadr2  gaia_source  random_index        BIGINT   \n",
       "1535  gaiadr2  gaia_source     ref_epoch   yr   DOUBLE   \n",
       "\n",
       "                                            description  \n",
       "1531                                Solution Identifier  \n",
       "1532  Unique source designation (unique across all D...  \n",
       "1533  Unique source identifier (unique within a part...  \n",
       "1534                Random index used to select subsets  \n",
       "1535                                    Reference epoch  "
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gp.gaia.columns.query('(table_name == \"gaia_source\") & schema == \"gaiadr2\"').head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Getting information about specific table(s)\n",
    "\n",
    "You can also get information about specific tables with GaiaTAP+."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [],
   "source": [
    "tables, columns = gp.gaia.get_table_info(only_tables=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>schema</th>\n",
       "      <th>table_name</th>\n",
       "      <th>description</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>public</td>\n",
       "      <td>hipparcos</td>\n",
       "      <td>hipparcos original catalogue (J1991.25)</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>public</td>\n",
       "      <td>hipparcos_newreduction</td>\n",
       "      <td>Hipparcos New Reduction: The Astrometric Catal...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>public</td>\n",
       "      <td>hubble_sc</td>\n",
       "      <td>Hubble Source Catalogue</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>public</td>\n",
       "      <td>igsl_source</td>\n",
       "      <td>null</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>public</td>\n",
       "      <td>igsl_source_catalog_ids</td>\n",
       "      <td>SourceId in original  catalogues</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75</th>\n",
       "      <td>gaiadr2</td>\n",
       "      <td>vari_short_timescale</td>\n",
       "      <td>This table describes the short-timescale sourc...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>76</th>\n",
       "      <td>gaiadr2</td>\n",
       "      <td>vari_time_series_statistics</td>\n",
       "      <td>Statistical parameters of time series, using o...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>77</th>\n",
       "      <td>gaiadr2</td>\n",
       "      <td>panstarrs1_original_valid</td>\n",
       "      <td>The Panoramic Survey Telescope and Rapid Respo...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>78</th>\n",
       "      <td>gaiadr2</td>\n",
       "      <td>gaia_source</td>\n",
       "      <td>This table has an entry for every Gaia observe...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>79</th>\n",
       "      <td>gaiadr2</td>\n",
       "      <td>ruwe</td>\n",
       "      <td>This table contains the Renormalised Unit Weig...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>80 rows × 3 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "     schema                   table_name  \\\n",
       "0    public                    hipparcos   \n",
       "1    public       hipparcos_newreduction   \n",
       "2    public                    hubble_sc   \n",
       "3    public                  igsl_source   \n",
       "4    public      igsl_source_catalog_ids   \n",
       "..      ...                          ...   \n",
       "75  gaiadr2         vari_short_timescale   \n",
       "76  gaiadr2  vari_time_series_statistics   \n",
       "77  gaiadr2    panstarrs1_original_valid   \n",
       "78  gaiadr2                  gaia_source   \n",
       "79  gaiadr2                         ruwe   \n",
       "\n",
       "                                          description  \n",
       "0             hipparcos original catalogue (J1991.25)  \n",
       "1   Hipparcos New Reduction: The Astrometric Catal...  \n",
       "2                             Hubble Source Catalogue  \n",
       "3                                                null  \n",
       "4                    SourceId in original  catalogues  \n",
       "..                                                ...  \n",
       "75  This table describes the short-timescale sourc...  \n",
       "76  Statistical parameters of time series, using o...  \n",
       "77  The Panoramic Survey Telescope and Rapid Respo...  \n",
       "78  This table has an entry for every Gaia observe...  \n",
       "79  This table contains the Renormalised Unit Weig...  \n",
       "\n",
       "[80 rows x 3 columns]"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "tables"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<pandas.core.groupby.generic.DataFrameGroupBy object at 0x7fb817c87c50>"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# count number of columns for each schema\n",
    "columns.groupby('schema')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Query the Gaia database\n",
    "\n",
    "There are two kinds of queries supported: synchronous and asynchonous.\n",
    "\n",
    "Let's start with synchonous queries.\n",
    "\n",
    "### Synchronous queries\n",
    "\n",
    "Use `.query` to send an ADQL query to the database. The default behaviour is to request output in csv format and read resulting table as pandas.DataFrame."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>solution_id</th>\n",
       "      <th>designation</th>\n",
       "      <th>source_id</th>\n",
       "      <th>random_index</th>\n",
       "      <th>...</th>\n",
       "      <th>lum_percentile_lower</th>\n",
       "      <th>lum_percentile_upper</th>\n",
       "      <th>datalink_url</th>\n",
       "      <th>epoch_photometry_url</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>163572...</td>\n",
       "      <td>Gaia D...</td>\n",
       "      <td>387526...</td>\n",
       "      <td>459847817</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>https:...</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>163572...</td>\n",
       "      <td>Gaia D...</td>\n",
       "      <td>387502...</td>\n",
       "      <td>229923908</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>https:...</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>163572...</td>\n",
       "      <td>Gaia D...</td>\n",
       "      <td>387646...</td>\n",
       "      <td>114961954</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>https:...</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>163572...</td>\n",
       "      <td>Gaia D...</td>\n",
       "      <td>387506...</td>\n",
       "      <td>57480977</td>\n",
       "      <td>...</td>\n",
       "      <td>0.909308</td>\n",
       "      <td>1.484657</td>\n",
       "      <td>https:...</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>163572...</td>\n",
       "      <td>Gaia D...</td>\n",
       "      <td>387649...</td>\n",
       "      <td>108811...</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>https:...</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 96 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   solution_id designation  source_id  random_index  ...  \\\n",
       "0  163572...    Gaia D...   387526...  459847817     ...   \n",
       "1  163572...    Gaia D...   387502...  229923908     ...   \n",
       "2  163572...    Gaia D...   387646...  114961954     ...   \n",
       "3  163572...    Gaia D...   387506...   57480977     ...   \n",
       "4  163572...    Gaia D...   387649...  108811...     ...   \n",
       "\n",
       "   lum_percentile_lower  lum_percentile_upper  datalink_url  \\\n",
       "0        NaN                   NaN             https:...      \n",
       "1        NaN                   NaN             https:...      \n",
       "2        NaN                   NaN             https:...      \n",
       "3   0.909308              1.484657             https:...      \n",
       "4        NaN                   NaN             https:...      \n",
       "\n",
       "   epoch_photometry_url  \n",
       "0        NaN             \n",
       "1        NaN             \n",
       "2        NaN             \n",
       "3        NaN             \n",
       "4        NaN             \n",
       "\n",
       "[5 rows x 96 columns]"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "r = gp.gaia.query('select top 10 * from gaiadr2.gaia_source', output_format='csv')\n",
    "print(type(r))\n",
    "import pandas as pd\n",
    "pd.set_option('display.max_columns', 8, 'display.max_colwidth', 10)\n",
    "r.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Wrong queries will raise exception with a useful message from the server."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "ename": "HTTPError",
     "evalue": "Cannot parse query 'select top 5 * from foo.bar' for job '1550666502785O': 1 unresolved identifiers: bar [l.1 c.21 - l.1 c.28] !",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mHTTPError\u001b[0m                                 Traceback (most recent call last)",
      "\u001b[0;32m~/projects/gapipes/gapipes/gaia/core.py\u001b[0m in \u001b[0;36mquery\u001b[0;34m(self, query, name, upload_resource, upload_table_name, output_format)\u001b[0m\n\u001b[1;32m    194\u001b[0m         \u001b[0;32mtry\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 195\u001b[0;31m             \u001b[0mr\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mraise_for_status\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    196\u001b[0m             \u001b[0;32mreturn\u001b[0m \u001b[0mTap\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mparse_result_table\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mr\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0moutput_format\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/miniconda3/envs/research/lib/python3.7/site-packages/requests/models.py\u001b[0m in \u001b[0;36mraise_for_status\u001b[0;34m(self)\u001b[0m\n\u001b[1;32m    938\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mhttp_error_msg\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 939\u001b[0;31m             \u001b[0;32mraise\u001b[0m \u001b[0mHTTPError\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mhttp_error_msg\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mresponse\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    940\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;31mHTTPError\u001b[0m: 500 Server Error: 500 for url: https://gea.esac.esa.int/tap-server/tap/sync",
      "\nThe above exception was the direct cause of the following exception:\n",
      "\u001b[0;31mHTTPError\u001b[0m                                 Traceback (most recent call last)",
      "\u001b[0;32m<ipython-input-9-baaf9fa1f68b>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0mr\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mgp\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mgaia\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mquery\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'select top 5 * from foo.bar'\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m",
      "\u001b[0;32m~/projects/gapipes/gapipes/gaia/core.py\u001b[0m in \u001b[0;36mquery\u001b[0;34m(self, query, name, upload_resource, upload_table_name, output_format)\u001b[0m\n\u001b[1;32m    197\u001b[0m         \u001b[0;32mexcept\u001b[0m \u001b[0mHTTPError\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0me\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    198\u001b[0m             \u001b[0mmessage\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mparse_votable_error_response\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mr\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 199\u001b[0;31m             \u001b[0;32mraise\u001b[0m \u001b[0mHTTPError\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mmessage\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;32mfrom\u001b[0m \u001b[0me\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    200\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    201\u001b[0m     def query_async(self, query, name=None,\n",
      "\u001b[0;31mHTTPError\u001b[0m: Cannot parse query 'select top 5 * from foo.bar' for job '1550666502785O': 1 unresolved identifiers: bar [l.1 c.21 - l.1 c.28] !"
     ]
    }
   ],
   "source": [
    "r = gp.gaia.query('select top 5 * from foo.bar')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Asynchronous queries\n",
    "\n",
    "For a more complicated queries that takes longer than 30 seconds,\n",
    "use `.query_async`. The interface is the same except the return value is now a `Job` instance."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Job(jobid='1550666562163O', phase='EXECUTING')"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "query = \"\"\"\n",
    "select \n",
    "    count(*) as n, \n",
    "    round(phot_g_mean_mag, 1) as val\n",
    "from \n",
    "    gaiadr1.tgas_source \n",
    "group by val\n",
    "order by val\n",
    "\"\"\"\n",
    "j = gp.gaia.query_async(query, output_format='csv', name='histogram')\n",
    "j"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Use `.get_result` to wait until the job is finished and download the result."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "CPU times: user 29.2 ms, sys: 11.7 ms, total: 40.9 ms\n",
      "Wall time: 3.42 s\n"
     ]
    }
   ],
   "source": [
    "%%time\n",
    "r = j.get_result()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [],
   "source": [
    "%matplotlib inline"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "r.plot('val', 'n');"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Inspect `Job` if needed."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "select \n",
      "    count(*) as n, \n",
      "    round(phot_g_mean_mag, 1) as val\n",
      "from \n",
      "    gaiadr1.tgas_source \n",
      "group by val\n",
      "order by val\n",
      "\n"
     ]
    }
   ],
   "source": [
    "print(j.query)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "https://gea.esac.esa.int/tap-server/tap/async/1550666562163O\n",
      "https://gea.esac.esa.int/tap-server/tap/async/1550666562163O/results/result\n"
     ]
    }
   ],
   "source": [
    "print(j.url)\n",
    "print(j.result_url)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Using authenticated service\n",
    "\n",
    "There are some benefits to using Gaia TAP+ authenticated service (with an account).\n",
    "\n",
    "Log in and out of server using `gp.gaia.login` and `gp.gaia.logout`.\n",
    "\n",
    "**NOTE**:\n",
    "\n",
    "- Once you are logged in, the result of `get_table_info` method includes your user tables if any.\n",
    "- Once you are logged in, `list_jobs` method only lists jobs you launched."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "name": "stdin",
     "output_type": "stream",
     "text": [
      "User:  soh\n",
      "Password:  ············\n"
     ]
    }
   ],
   "source": [
    "gp.gaia.login()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Managing user tables\n",
    "\n",
    "Once you login, you can upload your own tables to user space."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "\"Uploaded file (size: 0) into 'foobar123'\""
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import pandas as pd\n",
    "from astropy.table import Table\n",
    "\n",
    "mytable = Table.from_pandas(pd.DataFrame(dict(a=[1,2,3], b=[4,5,6])))\n",
    "gp.gaia.upload_table(mytable, 'foobar123', table_description='test table to demonstrate upload')\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Let's check if the table is there."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>foobar123_oid</th>\n",
       "      <th>a</th>\n",
       "      <th>b</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>6</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   foobar123_oid  a  b\n",
       "0              1  1  4\n",
       "1              2  2  5\n",
       "2              3  3  6"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gp.gaia.query('select * from user_soh.foobar123;')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now let's delete."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "\"Table 'foobar123' removed.\""
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "gp.gaia.delete_user_table('foobar123')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "If we try to query a deleted table, we should get an error."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "ename": "HTTPError",
     "evalue": "Cannot parse query 'select * from user_soh.foobar123;' for job '1553653744533O': 1 unresolved identifiers: foobar123 [l.1 c.15 - l.1 c.33] !",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mHTTPError\u001b[0m                                 Traceback (most recent call last)",
      "\u001b[0;32m~/projects/gapipes/gapipes/gaia/core.py\u001b[0m in \u001b[0;36mquery\u001b[0;34m(self, query, name, upload_resource, upload_table_name, output_format)\u001b[0m\n\u001b[1;32m    202\u001b[0m         \u001b[0;32mtry\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 203\u001b[0;31m             \u001b[0mr\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mraise_for_status\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    204\u001b[0m             \u001b[0;32mreturn\u001b[0m \u001b[0mTap\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mparse_result_table\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mr\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0moutput_format\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m~/miniconda3/envs/research/lib/python3.7/site-packages/requests/models.py\u001b[0m in \u001b[0;36mraise_for_status\u001b[0;34m(self)\u001b[0m\n\u001b[1;32m    938\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mhttp_error_msg\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 939\u001b[0;31m             \u001b[0;32mraise\u001b[0m \u001b[0mHTTPError\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mhttp_error_msg\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mresponse\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    940\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;31mHTTPError\u001b[0m: 500 Server Error: 500 for url: https://gea.esac.esa.int/tap-server/tap/sync",
      "\nThe above exception was the direct cause of the following exception:\n",
      "\u001b[0;31mHTTPError\u001b[0m                                 Traceback (most recent call last)",
      "\u001b[0;32m<ipython-input-8-b26c452954ec>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0mgp\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mgaia\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mquery\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'select * from user_soh.foobar123;'\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m",
      "\u001b[0;32m~/projects/gapipes/gapipes/gaia/core.py\u001b[0m in \u001b[0;36mquery\u001b[0;34m(self, query, name, upload_resource, upload_table_name, output_format)\u001b[0m\n\u001b[1;32m    205\u001b[0m         \u001b[0;32mexcept\u001b[0m \u001b[0mHTTPError\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0me\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    206\u001b[0m             \u001b[0mmessage\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mparse_votable_error_response\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mr\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 207\u001b[0;31m             \u001b[0;32mraise\u001b[0m \u001b[0mHTTPError\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mmessage\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;32mfrom\u001b[0m \u001b[0me\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    208\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    209\u001b[0m     def query_async(self, query, name=None,\n",
      "\u001b[0;31mHTTPError\u001b[0m: Cannot parse query 'select * from user_soh.foobar123;' for job '1553653744533O': 1 unresolved identifiers: foobar123 [l.1 c.15 - l.1 c.33] !"
     ]
    }
   ],
   "source": [
    "gp.gaia.query('select * from user_soh.foobar123;')"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
